<style>
.page-padding {
  padding: 40rpx 30rpx;
}
.index-cell-div {
  margin-bottom: 40rpx;
  background-color: #fff;
}
.cell-head {
  display: flex;
  border-top: 8rpx #fc6e24 solid;
}
.my-title {
  width: 168rpx;
  position: relative;
  color: #fff;
  text-align: center;
  font-size: 32rpx;
  padding: 12rpx 20rpx 20rpx 20rpx;
}
.title-triangle {
  height: 0;
  width: 0;
  border-top: 78rpx solid;
  border-right: 78rpx solid transparent;
}

.head-green {
  background-color: #20bf63;
}
.triangle-green {
  border-top-color: #20bf63;
}

.head-yellow {
  background-color: #fecc2f;
}

.triangle-yellow {
  border-top-color: #fecc2f;
}
.head-red {
  background-color: #fc6e24;
}
.triangle-red {
  border-top-color: #fc6e24;
}
.cell-content {
  border-bottom-left-radius: 8rpx;
  border-bottom-right-radius: 8rpx;
  padding: 40rpx 30rpx;
}
.zan-col {
  text-align: center;
}
.col-h {
  color: #000;
  font-size: 32rpx;
}
.col-f {
  font-size: 26rpx;
}
.col-btn {
  line-height: 74rpx;
  color: #fecc2f;
  border-radius: 38rpx;
  border: 1px #fecc2f solid;
}
.navigator-hover {
  color: #fff;
  background-color: #fecc2f;
}
.more-div {
  flex: 1;
  display: flex;
  justify-content: flex-end;
}
.more {
  display: block;
  width: 30px;
  height: 30px;
  background-size: 30px;
  background-position: center;
  background-repeat: no-repeat;
}
.my-row {
  width: auto;
}
.toverify-view {
  width: 100rpx;
  height: 100rpx;
  margin-left: auto;
  margin-right: auto;
  display: flex;
  justify-content: center;
  align-items: center;
  background-color: #f8a312;
  border-radius: 50%;
}
.verify-icon {
  font-size: 60rpx;
  color: #fff;
}
</style>

<template>
  <view class="page-padding">
    <navigator hover-class="none" url="/pages/merchant/verifyDetail" >
      <view class="index-cell-div">
        <view class="cell-head triangle-red">
          <view class="my-title head-red">今日交易</view>
          <view class="title-triangle triangle-red"></view>
          <view class="more-div">
            <image class="more" src="data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTYgMTBjLTEuMSAwLTIgLjktMiAycy45IDIgMiAyIDItLjkgMi0yLS45LTItMi0yem0xMiAwYy0xLjEgMC0yIC45LTIgMnMuOSAyIDIgMiAyLS45IDItMi0uOS0yLTItMnptLTYgMGMtMS4xIDAtMiAuOS0yIDJzLjkgMiAyIDIgMi0uOSAyLTItLjktMi0yLTJ6Ii8+PC9zdmc+"></image>
          </view>
        </view>
        <view class="cell-content zan-row my-row">
          <view class="zan-col zan-col-8">
            <view class="col-h zan-font-bold">{{result.pay_price}}</view>
            <view class="col-f zan-c-gray-dark">交易金额</view>
          </view>
          <view class="zan-col zan-col-8">
            <view class="col-h zan-font-bold">{{result.pay_points}}</view>
            <view class="col-f zan-c-gray-dark">交易积分</view>
          </view>
          <view class="zan-col zan-col-8">
            <view class="col-h zan-font-bold">{{result.pay_count}}</view>
            <view class="col-f zan-c-gray-dark">交易笔数</view>
          </view>
        </view>
      </view>
    </navigator>
    <navigator hover-class="none" url="/pages/merchant/clearDetail" >
      <view class="index-cell-div">
        <view class="cell-head triangle-green">
          <view class="my-title head-green">结算</view>
          <view class="title-triangle triangle-green"></view>
          <view class="more-div">
            <image class="more" src="data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTYgMTBjLTEuMSAwLTIgLjktMiAycy45IDIgMiAyIDItLjkgMi0yLS45LTItMi0yem0xMiAwYy0xLjEgMC0yIC45LTIgMnMuOSAyIDIgMiAyLS45IDItMi0uOS0yLTItMnptLTYgMGMtMS4xIDAtMiAuOS0yIDJzLjkgMiAyIDIgMi0uOSAyLTItLjktMi0yLTJ6Ii8+PC9zdmc+"></image>
          </view>
        </view>
        <view class="cell-content zan-row my-row">
          <view class="zan-col zan-col-8">
            <view class="col-h zan-font-bold">{{result.sum_today_price}}</view>
            <view class="col-f zan-c-gray-dark">今日结算金额</view>
          </view>
          <view class="zan-col zan-col-8">
            <view class="col-h zan-font-bold">{{result.wait_sum_price}}</view>
            <view class="col-f zan-c-gray-dark">未结算金额</view>
          </view>
          <view class="zan-col zan-col-8">
            <view class="col-h zan-font-bold">{{result.sum_price}}</view>
            <view class="col-f zan-c-gray-dark">总结算金额</view>
          </view>
        </view>
      </view>
    </navigator>
  </view>
</template>

<script>
import wepy from "wepy";
import { api, root } from "@/config";
import request from "@/utils/request";
import {price } from "@/utils/format";
export default class extends wepy.component {
  config = {
    navigationBarTitleText: "商户首页"
  };
  data = {
    result: {
      sum_today_price: 0,
      wait_sum_price: 0,
      sum_price: 0,
      pay_count: 0,
      pay_price: 0,
      pay_points: 0,
    },
    hasShown: false
  };
  onShow() {
    const { merchant } = this.$root.$parent.globalData;
    if (merchant && !this.hasShown) {
      //this.hasShown = true;
      setTimeout(() => {
        this.fetchGetData(merchant.shop.id);
      }, 0);
    }
  }
  methods = {
    goToShop() {
      const data = this.$root.$parent.globalData;
      data.customerId = data.merchantId;
      data.customer = data.merchant;
      wx.navigateTo({ url: "/pages/customer/index" });
    }
  };
  async fetchGetData(shop_id) {
    const result = await request(`${api.merchantIndex}/${shop_id}`, {
      data: {}
    });
    result.pay_price = price(result.pay_price);
    result.sum_today_price = price(result.sum_today_price);
    result.wait_sum_price = price(result.wait_sum_price);
    result.sum_price = price(result.sum_price);
    this.result = result;
    this.$apply();
  }
}
</script>
